<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-going-further" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Going further | Tairu: the Tiles framework</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://tairu.dev/docs/going-further><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Going further | Tairu: the Tiles framework"><meta data-rh=true name=description content="If you have not read the quick start guide yet, please read it first."><meta data-rh=true property=og:description content="If you have not read the quick start guide yet, please read it first."><link data-rh=true rel=icon href=/img/favicon.svg><link data-rh=true rel=canonical href=https://tairu.dev/docs/going-further><link data-rh=true rel=alternate href=https://tairu.dev/docs/going-further hreflang=en><link data-rh=true rel=alternate href=https://tairu.dev/docs/going-further hreflang=x-default><link rel=preconnect href=https://metrics.tairu.dev><script async defer src=https://metrics.tairu.dev/script.js data-website-id=008da516-7e31-40c3-9f05-1b72bed9ffb3 data-auto-track data-do-not-track data-cache></script><link rel=stylesheet href=/assets/css/styles.b87dece3.css><script src=/assets/js/runtime~main.7c2b8b00.js defer></script><script src=/assets/js/main.fb23c511.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_sgYA href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/logo-light.svg alt=Tairu class="themedComponent_ifQe themedComponent--light_ig45"><img src=/img/logo-dark.svg alt=Tairu class="themedComponent_ifQe themedComponent--dark__iFm"></div></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/docs/overview>Documentation</a><a class="navbar__item navbar__link" href=/docs/api>API</a><a class="navbar__item navbar__link" href=/pricing>Pricing</a></div><div class="navbar__items navbar__items--right"><div class="toggle_oKzQ colorModeToggle_Hg8w"><button class="clean-btn toggleButton_sMbR toggleButtonDisabled_S8Px" type=button disabled title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_gGuT><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_VO3J><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_Syza><div><orama-search-button color-scheme=light>Search</orama-search-button></div></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_pqQK"><div class=docsWrapper_UXHt><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_pzOa" type=button></button><div class=docRoot_KPLr><aside class="theme-doc-sidebar-container docSidebarContainer_WzEh"><div class=sidebarViewport_P4Ii><div class=sidebar_tVQl><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_QBv8"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/overview>Overview</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/quick-start>Quick start</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current=page href=/docs/going-further>Going further</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/agents>Agents</a><button aria-label="Expand sidebar category 'Agents'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/integrations/next>Integrations</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class=menu__link>Reference</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/concepts>Core concepts</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/protocol>Tairu protocol</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/cli>Tairu CLI</a></ul></ul></nav></div></div></aside><main class=docMainContainer_FO6m><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_u6XT"><div class=docItemContainer_wczt><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_RnD0" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_yCM5><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Going further</span><meta itemprop=position content=1></ul></nav><div class="tocCollapsible_KtER theme-doc-toc-mobile tocMobile_OjEQ"><button type=button class="clean-btn tocCollapsibleButton_Alpq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Going further</h1></header>
<div class="theme-admonition theme-admonition-warning admonition_N3xA alert alert--warning"><div class=admonitionHeading_Yp8s><span class=admonitionIcon_KCuR><svg viewBox="0 0 16 16"><path fill-rule=evenodd d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg></span>warning</div><div class=admonitionContent_j5hF><p>If you have not read the <a href=/docs/quick-start>quick start guide</a> yet, please read it first.<p>This guide assumes you are already familiar with the concepts presented in the quick start guide.</div></div>
<h2 class="anchor anchorWithStickyNavbar_yaAl" id=project-overview>Project overview<a href=#project-overview class=hash-link aria-label="Direct link to Project overview" title="Direct link to Project overview">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_yaAl" id=what-are-we-building>What are we building?<a href=#what-are-we-building class=hash-link aria-label="Direct link to What are we building?" title="Direct link to What are we building?">​</a></h3>
<p>In this guide, we'll create a Tiles server that can be used to create simple polls (with up to 5 choices of answers) and display and interact with the polls.</p>
<p>This guide uses TypeScript to make the types used explicit, but you can use plain JavaScript if you prefer.</p>
<h3 class="anchor anchorWithStickyNavbar_yaAl" id=tairu-concepts-we-will-cover>Tairu concepts we will cover<a href=#tairu-concepts-we-will-cover class=hash-link aria-label="Direct link to Tairu concepts we will cover" title="Direct link to Tairu concepts we will cover">​</a></h3>
<p>This guide will show how to use the following concepts:</p>
<ul>
<li>Supporting multiple Tile handlers in a single server.</li>
<li>Using route parameters with Tile handlers.</li>
<li>Interacting with a database from Tile handlers.</li>
<li>Managing stateful interactions with Tiles.</li>
</ul>
<div class="theme-admonition theme-admonition-warning admonition_N3xA alert alert--warning"><div class=admonitionHeading_Yp8s><span class=admonitionIcon_KCuR><svg viewBox="0 0 16 16"><path fill-rule=evenodd d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg></span>warning</div><div class=admonitionContent_j5hF><p>This guide is intentionally limited in scope and focuses only on presenting some features of the Tairu framework. It <strong>does not</strong> cover subjects such as input sanitization, error handling, access control or other generic application topics.</div></div>
<h2 class="anchor anchorWithStickyNavbar_yaAl" id=setting-up-the-project>Setting up the project<a href=#setting-up-the-project class=hash-link aria-label="Direct link to Setting up the project" title="Direct link to Setting up the project">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_yaAl" id=project-creation>Project creation<a href=#project-creation class=hash-link aria-label="Direct link to Project creation" title="Direct link to Project creation">​</a></h3>
<p>Create a new folder for your project and initialize the <code>package.json</code> file, for example using your package manager:</p>
<div class="tabs-container tabList_Catn"><ul role=tablist aria-orientation=horizontal class=tabs><li role=tab tabindex=0 aria-selected=true class="tabs__item tabItem_mfQ4 tabs__item--active">npm<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_mfQ4">pnpm</ul><div class=margin-top--md><div role=tabpanel class=tabItem_TBo_><div class="language-sh codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-sh codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_juFO><span class=token-line style=color:#393A34><span class="token plain">npm init -y</span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div></div><div role=tabpanel class=tabItem_TBo_ hidden><div class="language-sh codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-sh codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_juFO><span class=token-line style=color:#393A34><span class="token plain">pnpm init</span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_yaAl" id=adding-dependencies>Adding dependencies<a href=#adding-dependencies class=hash-link aria-label="Direct link to Adding dependencies" title="Direct link to Adding dependencies">​</a></h3>
<p>We'll add the following dependencies to our project:</p>
<ul>
<li><code>tairu</code>: the Tairu CLI, that we will use to start a local server.</li>
<li><code>@tairu/handler</code>: the library that we will use to create our Tile handlers.</li>
<li><code>@tairu/protocol</code>: protocol type definitions, only needed if you are using TypeScript.</li>
<li><code>level</code>: a simple <a href=https://github.com/Level/level target=_blank rel="noopener noreferrer">key-value database</a> we will use to store the polls.</li>
</ul>
<div class="tabs-container tabList_Catn"><ul role=tablist aria-orientation=horizontal class=tabs><li role=tab tabindex=0 aria-selected=true class="tabs__item tabItem_mfQ4 tabs__item--active">npm<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_mfQ4">pnpm</ul><div class=margin-top--md><div role=tabpanel class=tabItem_TBo_><div class="language-sh codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-sh codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_juFO><span class=token-line style=color:#393A34><span class="token plain">npm install tairu @tairu/handler @tairu/protocol level</span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div></div><div role=tabpanel class=tabItem_TBo_ hidden><div class="language-sh codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-sh codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_juFO><span class=token-line style=color:#393A34><span class="token plain">pnpm add tairu @tairu/handler @tairu/protocol level</span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_yaAl" id=database-setup>Database setup<a href=#database-setup class=hash-link aria-label="Direct link to Database setup" title="Direct link to Database setup">​</a></h3>
<p>Let's create a <code>handler.tsx</code> (or <code>handler.jsx</code> if you are using JavaScript) file in our project folder and add the following code:</p>
<div class="language-tsx codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_QsD_>handler.tsx</div><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-tsx codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class="codeBlockLines_juFO codeBlockLinesWithNumbering_BHOA"><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token imports punctuation" style=color:#393A34>{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Level</span><span class="token imports"> </span><span class="token imports punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'level'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Questions have a title and a list of choices</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">PollQuestion</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  title</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  choices</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Answers are a mapping of DID to choice index</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">PollAnswers</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token maybe-class-name">Record</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> db </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Level</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'polls-db'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> questionsDB </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> db</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">sublevel</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token maybe-class-name">PollQuestion</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'questions'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> valueEncoding</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'json'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> answersDB </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> db</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">sublevel</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token maybe-class-name">PollAnswers</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'answers'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> valueEncoding</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'json'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span></span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Here, we define the types for a poll question (line 4) and answers (line 10) and create our Level databases to store them.</p>
<p>The answers are stored as a mapping of the unique user <a href=/docs/concepts#dids>DID</a> that submitted the answer to the index of their choice.</p>
<h2 class="anchor anchorWithStickyNavbar_yaAl" id=poll-creation>Poll creation<a href=#poll-creation class=hash-link aria-label="Direct link to Poll creation" title="Direct link to Poll creation">​</a></h2>
<p>Now that we can store polls, we'll create a Tile handler to create them.</p>
<h3 class="anchor anchorWithStickyNavbar_yaAl" id=setting-the-poll-question>Setting the poll question<a href=#setting-the-poll-question class=hash-link aria-label="Direct link to Setting the poll question" title="Direct link to Setting the poll question">​</a></h3>
<p>We'll start by defining the Tile that gets rendered by default, when no action has been submitted yet. This Tile will prompt the user to create a poll by first defining the question:</p>
<div class="language-tsx codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_QsD_>handler.tsx</div><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-tsx codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class="codeBlockLines_juFO codeBlockLinesWithNumbering_BHOA"><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Box</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">SubmitAction</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Text</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">TextInput</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Tile</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">TileHandler</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'@tairu/handler'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token imports punctuation" style=color:#393A34>{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Level</span><span class="token imports"> </span><span class="token imports punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'level'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Questions have a title and a list of choices</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">PollQuestion</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  title</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  choices</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Answers are a mapping of DID to choice index</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">PollAnswers</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token maybe-class-name">Record</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> db </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Level</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'polls-db'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> questionsDB </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> db</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">sublevel</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token maybe-class-name">PollQuestion</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'questions'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> valueEncoding</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'json'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> answersDB </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> db</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">sublevel</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token maybe-class-name">PollAnswers</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'answers'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> valueEncoding</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'json'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> createPollHandler</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token function-variable function" style=color:#d73a49>TileHandler</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>        </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Create a new poll</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>        </span><span class="token tag attr-name" style=color:#00a4db>input</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>TextInput</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Poll question</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>        </span><span class="token tag attr-name" style=color:#00a4db>actions</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Next</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">Create a new poll by first setting a question</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span></span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_yaAl" id=adding-choices>Adding choices<a href=#adding-choices class=hash-link aria-label="Direct link to Adding choices" title="Direct link to Adding choices">​</a></h3>
<p>Once the question is defined, the action will be provided to the request and we can display another Tile, this time asking to add a first choice.</p>
<p>Because we will need to display a Tile for each choice, we'll create the <code>displayPollChoice</code> helper function and use it in our <code>createPollHandler</code> function:</p>
<div class="language-tsx codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_QsD_>handler.tsx</div><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-tsx codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class="codeBlockLines_juFO codeBlockLinesWithNumbering_BHOA"><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Box</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">SubmitAction</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Text</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">TextInput</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Tile</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">TileHandler</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'@tairu/handler'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token imports punctuation" style=color:#393A34>{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Level</span><span class="token imports"> </span><span class="token imports punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'level'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Questions have a title and a list of choices</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">PollQuestion</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  title</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  choices</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Answers are a mapping of DID to choice index</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">PollAnswers</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token maybe-class-name">Record</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> db </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Level</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'polls-db'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> questionsDB </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> db</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">sublevel</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token maybe-class-name">PollQuestion</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'questions'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> valueEncoding</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'json'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> answersDB </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> db</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">sublevel</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token maybe-class-name">PollAnswers</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'answers'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> valueEncoding</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'json'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">CreatePollState</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  question</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  choices</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  save</span><span class="token operator" style=color:#393A34>?</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>displayPollChoice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">state</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">CreatePollState</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choicesCount </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">length</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> saveAction </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>key</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>save</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Save poll</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>state</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript spread operator" style=color:#393A34>...</span><span class="token tag script language-javascript" style=color:#00009f>state</span><span class="token tag script language-javascript punctuation" style=color:#393A34>,</span><span class="token tag script language-javascript" style=color:#00009f> save</span><span class="token tag script language-javascript operator" style=color:#393A34>:</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript boolean" style=color:#36acaa>true</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> actions </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Max number of choices, only action is to save the poll</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    choicesCount </span><span class="token operator" style=color:#393A34>===</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>4</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>?</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      saveAction</span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// At least 2 choices must be provided</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    choicesCount </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>?</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Next</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>state</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>state</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// 2 options: add another choice or save the poll</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>[</span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>key</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>next</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Add another choice</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>state</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>state</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> saveAction</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Create a new poll</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>input</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>TextInput</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Choice value</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>actions</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>actions</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">Add choice number </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">choicesCount </span><span class="token operator" style=color:#393A34>+</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain-text"> to the poll</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> createPollHandler</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token function-variable function" style=color:#d73a49>TileHandler</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>        </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Create a new poll</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>        </span><span class="token tag attr-name" style=color:#00a4db>input</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>TextInput</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Poll question</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>        </span><span class="token tag attr-name" style=color:#00a4db>actions</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Next</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">Create a new poll by first setting a question</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>!==</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'did/submit'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Poll error</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">unsupported action</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// If there is no state in the action, it's setting the question</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>displayPollChoice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> question</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> choices</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> state </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token maybe-class-name">CreatePollState</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> newChoice </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choices </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> newChoice </span><span class="token operator" style=color:#393A34>===</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>''</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>?</span><span class="token plain"> state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token spread operator" style=color:#393A34>...</span><span class="token plain">state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> newChoice</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>!</span><span class="token plain">state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">save</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>||</span><span class="token plain"> choices</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Add another choice to the poll</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>displayPollChoice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token spread operator" style=color:#393A34>...</span><span class="token plain">state</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> choices </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span></span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>The <code>CreatePollState</code> defined line 24 represents the state of our poll creation. It is submitted along with the input value when using the submit action, so we can use it to keep track of the state of our poll during the creation process.</p>
<p>In our <code>createPollHandler</code>, we add the following logic:</p>
<ol>
<li>Line 64, we check if the action has the expected type, or display an error message.</li>
<li>Line 72, we check if the action has state. If it doesn't, it means the poll was just created with the question.</li>
<li>Line 79, we update our list of choices, unless the submitted value is an empty string.</li>
<li>Finally at line 81, we check if we should continue to display the form to add a choice.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_yaAl" id=saving-the-poll>Saving the poll<a href=#saving-the-poll class=hash-link aria-label="Direct link to Saving the poll" title="Direct link to Saving the poll">​</a></h3>
<p>Once all the choices have been added, we can save the poll to the database:</p>
<div class="language-tsx codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_QsD_>handler.tsx</div><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-tsx codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class="codeBlockLines_juFO codeBlockLinesWithNumbering_BHOA"><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Box</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">OpenAction</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">SubmitAction</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Text</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">TextInput</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Tile</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">TileHandler</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'@tairu/handler'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token imports punctuation" style=color:#393A34>{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Level</span><span class="token imports"> </span><span class="token imports punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'level'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Questions have a title and a list of choices</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">PollQuestion</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  title</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  choices</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Answers are a mapping of DID to choice index</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">PollAnswers</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token maybe-class-name">Record</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> db </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Level</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'polls-db'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> questionsDB </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> db</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">sublevel</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token maybe-class-name">PollQuestion</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'questions'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> valueEncoding</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'json'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> answersDB </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> db</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">sublevel</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token maybe-class-name">PollAnswers</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'answers'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> valueEncoding</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'json'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">CreatePollState</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  question</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  choices</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  save</span><span class="token operator" style=color:#393A34>?</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>displayPollChoice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">state</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">CreatePollState</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choicesCount </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">length</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> saveAction </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>key</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>save</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Save poll</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>state</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript spread operator" style=color:#393A34>...</span><span class="token tag script language-javascript" style=color:#00009f>state</span><span class="token tag script language-javascript punctuation" style=color:#393A34>,</span><span class="token tag script language-javascript" style=color:#00009f> save</span><span class="token tag script language-javascript operator" style=color:#393A34>:</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript boolean" style=color:#36acaa>true</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> actions </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Max number of choices, only action is to save the poll</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    choicesCount </span><span class="token operator" style=color:#393A34>===</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>4</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>?</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      saveAction</span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// At least 2 choices must be provided</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    choicesCount </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>?</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Next</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>state</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>state</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// 2 options: add another choice or save the poll</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>[</span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>key</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>next</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Add another choice</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>state</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>state</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> saveAction</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Create a new poll</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>input</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>TextInput</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Choice value</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>actions</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>actions</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">Add choice number </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">choicesCount </span><span class="token operator" style=color:#393A34>+</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain-text"> to the poll</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> createPollHandler</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token function-variable function" style=color:#d73a49>TileHandler</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>        </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Create a new poll</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>        </span><span class="token tag attr-name" style=color:#00a4db>input</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>TextInput</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Poll question</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>        </span><span class="token tag attr-name" style=color:#00a4db>actions</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Next</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">Create a new poll by first setting a question</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>!==</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'did/submit'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Poll error</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">unsupported action</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// If there is no state in the action, it's setting the question</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>displayPollChoice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> question</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> choices</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> state </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token maybe-class-name">CreatePollState</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> newChoice </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choices </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> newChoice </span><span class="token operator" style=color:#393A34>===</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>''</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>?</span><span class="token plain"> state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token spread operator" style=color:#393A34>...</span><span class="token plain">state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> newChoice</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>!</span><span class="token plain">state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">save</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>||</span><span class="token plain"> choices</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Add another choice to the poll</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>displayPollChoice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token spread operator" style=color:#393A34>...</span><span class="token plain">state</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> choices </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Save the poll to the database</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> id </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> crypto</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>randomUUID</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> questionsDB</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>put</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">id</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> title</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">question</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> choices </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>      </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Poll created!</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>      </span><span class="token tag attr-name" style=color:#00a4db>actions</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>OpenAction</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Open poll</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>uri</span><span class="token tag script language-javascript tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag script language-javascript template-string template-punctuation string" style=color:#e3116c>`</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation" style=color:#00009f>request</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation punctuation" style=color:#393A34>.</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation" style=color:#00009f>urlPrefix</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript tag script language-javascript template-string string" style=color:#e3116c>/polls/</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation" style=color:#00009f>id</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript tag script language-javascript template-string template-punctuation string" style=color:#e3116c>`</span><span class="token tag script language-javascript tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">The poll was successfully created!</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span></span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>In order for the user to open the newly created poll, we use an <code>OpenAction</code> element (line 94) with the URL of the poll. This URL uses the <code>urlPrefix</code> defined in the handler <code>request</code> argument and the ID of the newly created poll.</p>
<h3 class="anchor anchorWithStickyNavbar_yaAl" id=serving-the-tile-handler>Serving the Tile handler<a href=#serving-the-tile-handler class=hash-link aria-label="Direct link to Serving the Tile handler" title="Direct link to Serving the Tile handler">​</a></h3>
<p>Now that our poll creation handler is ready, we need to serve it using the <code>handle</code> function from the <code>@tairu/handler</code> package (line 9) and using it as default export to serve our <code>createPollHandler</code> (line 101):</p>
<div class="language-tsx codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_QsD_>handler.tsx</div><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-tsx codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class="codeBlockLines_juFO codeBlockLinesWithNumbering_BHOA"><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Box</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">OpenAction</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">SubmitAction</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Text</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">TextInput</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Tile</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">TileHandler</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  handle</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'@tairu/handler'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token imports punctuation" style=color:#393A34>{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Level</span><span class="token imports"> </span><span class="token imports punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'level'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Questions have a title and a list of choices</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">PollQuestion</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  title</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  choices</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Answers are a mapping of DID to choice index</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">PollAnswers</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token maybe-class-name">Record</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> db </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Level</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'polls-db'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> questionsDB </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> db</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">sublevel</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token maybe-class-name">PollQuestion</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'questions'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> valueEncoding</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'json'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> answersDB </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> db</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">sublevel</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token maybe-class-name">PollAnswers</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'answers'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> valueEncoding</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'json'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">CreatePollState</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  question</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  choices</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  save</span><span class="token operator" style=color:#393A34>?</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>displayPollChoice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">state</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">CreatePollState</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choicesCount </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">length</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> saveAction </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>key</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>save</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Save poll</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>state</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript spread operator" style=color:#393A34>...</span><span class="token tag script language-javascript" style=color:#00009f>state</span><span class="token tag script language-javascript punctuation" style=color:#393A34>,</span><span class="token tag script language-javascript" style=color:#00009f> save</span><span class="token tag script language-javascript operator" style=color:#393A34>:</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript boolean" style=color:#36acaa>true</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> actions </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Max number of choices, only action is to save the poll</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    choicesCount </span><span class="token operator" style=color:#393A34>===</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>4</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>?</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      saveAction</span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// At least 2 choices must be provided</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    choicesCount </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>?</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Next</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>state</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>state</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// 2 options: add another choice or save the poll</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>[</span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>key</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>next</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Add another choice</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>state</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>state</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> saveAction</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Create a new poll</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>input</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>TextInput</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Choice value</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>actions</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>actions</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">Add choice number </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">choicesCount </span><span class="token operator" style=color:#393A34>+</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain-text"> to the poll</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> createPollHandler</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token function-variable function" style=color:#d73a49>TileHandler</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>        </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Create a new poll</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>        </span><span class="token tag attr-name" style=color:#00a4db>input</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>TextInput</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Poll question</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>        </span><span class="token tag attr-name" style=color:#00a4db>actions</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Next</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">Create a new poll by first setting a question</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>!==</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'did/submit'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Poll error</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">unsupported action</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// If there is no state in the action, it's setting the question</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>displayPollChoice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> question</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> choices</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> state </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token maybe-class-name">CreatePollState</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> newChoice </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choices </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> newChoice </span><span class="token operator" style=color:#393A34>===</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>''</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>?</span><span class="token plain"> state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token spread operator" style=color:#393A34>...</span><span class="token plain">state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> newChoice</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>!</span><span class="token plain">state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">save</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>||</span><span class="token plain"> choices</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Add another choice to the poll</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>displayPollChoice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token spread operator" style=color:#393A34>...</span><span class="token plain">state</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> choices </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Save the poll to the database</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> id </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> crypto</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>randomUUID</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> questionsDB</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>put</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">id</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> title</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">question</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> choices </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>      </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Poll created!</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>      </span><span class="token tag attr-name" style=color:#00a4db>actions</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>OpenAction</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Open poll</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>uri</span><span class="token tag script language-javascript tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag script language-javascript template-string template-punctuation string" style=color:#e3116c>`</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation" style=color:#00009f>request</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation punctuation" style=color:#393A34>.</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation" style=color:#00009f>urlPrefix</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript tag script language-javascript template-string string" style=color:#e3116c>/polls/</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation" style=color:#00009f>id</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript tag script language-javascript template-string template-punctuation string" style=color:#e3116c>`</span><span class="token tag script language-javascript tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">The poll was successfully created!</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>export</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>default</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>handle</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">createPollHandler</span><span class="token punctuation" style=color:#393A34>)</span></span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>At this stage, our handler should be ready to be served using the Tairu CLI. However, before trying to create polls, let's add another handler to display the polls.</p>
<h2 class="anchor anchorWithStickyNavbar_yaAl" id=poll-display>Poll display<a href=#poll-display class=hash-link aria-label="Direct link to Poll display" title="Direct link to Poll display">​</a></h2>
<p>Similar to the poll creation handler, we will add another handler responsible for loading polls from the database, displaying the answers stored and handling submissions.</p>
<h3 class="anchor anchorWithStickyNavbar_yaAl" id=loading-from-the-database>Loading from the database<a href=#loading-from-the-database class=hash-link aria-label="Direct link to Loading from the database" title="Direct link to Loading from the database">​</a></h3>
<div class="language-tsx codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_QsD_>handler.tsx</div><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-tsx codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class="codeBlockLines_juFO codeBlockLinesWithNumbering_BHOA"><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token comment" style=color:#999988;font-style:italic>// Previous code omitted for brevity</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> displayPollHandler</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">TileHandler</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> id</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> action</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> pathParams </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> pollID </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> pathParams</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">id</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> pollQuestion</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">PollQuestion</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> pollAnswers</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">PollAnswers</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>try</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    pollQuestion </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> questionsDB</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>get</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollID</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>catch</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Poll not found</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">Poll not found</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>try</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    pollAnswers </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> answersDB</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>get</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollID</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>catch</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    pollAnswers </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>export</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>default</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>handle</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token string-property property" style=color:#36acaa>'/'</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> createPollHandler</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token string-property property" style=color:#36acaa>'/polls/:id'</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> displayPollHandler</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span></span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Let's start from the <code>handle</code> function at line 25: instead of providing a single handler, we provide an object mapping paths to handlers.
Our poll creation will continue to be served at the root (<code>/</code> path), while our polls will be served at <code>/polls/:id</code> where <code>:id</code> is a parameter that will be provided to the handler.</p>
<p>In our <code>displayPollHandler</code>, we can retrieve the poll identifier using the <code>pathParams</code> object from the <code>request</code> argument at line 4. Using the identifier, we can retrieve the question (line 9) and answers (line 19) from our database.</p>
<p>Because LevelDB throws errors for missing keys, we need to handle those cases with <code>try</code>/<code>catch</code>. In case of error when retrieving the question, we return a Tile displaying an error message, while we default to using an empty object for answers.</p>
<h3 class="anchor anchorWithStickyNavbar_yaAl" id=displaying-the-poll>Displaying the poll<a href=#displaying-the-poll class=hash-link aria-label="Direct link to Displaying the poll" title="Direct link to Displaying the poll">​</a></h3>
<p>Now that we have loaded our poll and answers from the database, we can display them in a Tile.</p>
<div class="language-tsx codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_QsD_>handler.tsx</div><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-tsx codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class="codeBlockLines_juFO codeBlockLinesWithNumbering_BHOA"><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Box</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">BoxElement</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">BoxProps</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">OpenAction</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Option</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">OptionElement</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">OptionsInput</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">SubmitAction</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Text</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">TextInput</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token maybe-class-name">Tile</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">TileHandler</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  handle</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'@tairu/handler'</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token maybe-class-name">BoxStyleV0</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'@tairu/protocol'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Code omitted for brevity</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>Stack</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">props</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">BoxProps</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> style</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">BoxStyleV0</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token spread operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">props</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>??</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> flexDirection</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'column'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Box</span><span class="token tag" style=color:#00009f> </span><span class="token tag spread punctuation" style=color:#393A34>{</span><span class="token tag spread operator" style=color:#393A34>...</span><span class="token tag spread" style=color:#00009f>props</span><span class="token tag spread punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>style</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>style</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> displayPollHandler</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">TileHandler</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> id</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> action</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> pathParams </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> pollID </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> pathParams</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">id</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> pollQuestion</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">PollQuestion</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> pollAnswers</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">PollAnswers</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>try</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    pollQuestion </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> questionsDB</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>get</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollID</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>catch</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Poll not found</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">Poll not found</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>try</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    pollAnswers </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> answersDB</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>get</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollID</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>catch</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    pollAnswers </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> answersCounts </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name builtin">Array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollQuestion</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">length</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>fill</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choice </span><span class="token keyword" style=color:#00009f>of</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>values</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollAnswers</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    answersCounts</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">choice</span><span class="token punctuation" style=color:#393A34>]</span><span class="token operator" style=color:#393A34>++</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> answersList</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token maybe-class-name">BoxElement</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choicesOptions</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token maybe-class-name">OptionElement</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">index</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> choice</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>of</span><span class="token plain"> pollQuestion</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>entries</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> key </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> index</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>toString</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    answersList</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>push</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Box</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>key</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>key</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">          </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">choice</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain-text">: </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">answersCounts</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">index</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Box</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    choicesOptions</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>push</span><span class="token punctuation" style=color:#393A34>(</span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Option</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>key</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>key</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>choice</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>value</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>index</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>      </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>pollQuestion</span><span class="token tag script language-javascript punctuation" style=color:#393A34>.</span><span class="token tag script language-javascript property-access" style=color:#00009f>title</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>      </span><span class="token tag attr-name" style=color:#00a4db>input</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>OptionsInput</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>></span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>choicesOptions</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>OptionsInput</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>      </span><span class="token tag attr-name" style=color:#00a4db>actions</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Submit</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Stack</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">pollQuestion</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">title</span><span class="token punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Stack</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">answersList</span><span class="token punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Stack</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Stack</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>export</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>default</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>handle</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token string-property property" style=color:#36acaa>'/'</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> createPollHandler</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token string-property property" style=color:#36acaa>'/polls/:id'</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> displayPollHandler</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span></span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Before going into the details of the answers list and options input, let's first look at a new component we're adding at line 20: <code>Stack</code>.</p>
<p>Thought Tairu is not a React framework and does not support React functionalities such as hooks, it is possible to create custom components using Tairu's primitive components such as <code>Box</code>. Here, our <code>Stack</code> simply sets a default <code>style</code> to the component to display its children as column rather than a row.</p>
<p>To display the answers, we iterate over the answers object to count the number of votes for each choice (line 47) and then iterate over the poll's choices to display create both the list of answers (line 55) and the list of options (line 62) that can be submitted.</p>
<p>Finally, the <code>Tile</code> element we return uses the <code>OptionsInput</code> input to provide to options that can be submitted and displays the list of anwers.</p>
<h3 class="anchor anchorWithStickyNavbar_yaAl" id=handling-submissions>Handling submissions<a href=#handling-submissions class=hash-link aria-label="Direct link to Handling submissions" title="Direct link to Handling submissions">​</a></h3>
<p>The last step for our poll handler to be complete is to handle submissions:</p>
<div class="language-tsx codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_QsD_>handler.tsx</div><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-tsx codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class="codeBlockLines_juFO codeBlockLinesWithNumbering_BHOA"><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token comment" style=color:#999988;font-style:italic>// Previous code omitted for brevity</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> displayPollHandler</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">TileHandler</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> id</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> action</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> pathParams </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> pollID </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> pathParams</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">id</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> pollQuestion</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">PollQuestion</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> pollAnswers</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">PollAnswers</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>try</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    pollQuestion </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> questionsDB</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>get</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollID</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>catch</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Poll not found</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">Poll not found</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>try</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    pollAnswers </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> answersDB</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>get</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollID</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>catch</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    pollAnswers </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token operator" style=color:#393A34>?.</span><span class="token plain">type </span><span class="token operator" style=color:#393A34>===</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'did/submit'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> did </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">did</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choice </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">number</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">choice </span><span class="token operator" style=color:#393A34>!=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// Save provided choice</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      pollAnswers</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">did</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> choice</span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> answersDB</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>put</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollID</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> pollAnswers</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>else</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollAnswers</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">did</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>!=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// No choice provided, remove existing one</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token keyword" style=color:#00009f>delete</span><span class="token plain"> pollAnswers</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">did</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> answersDB</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>put</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollID</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> pollAnswers</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> answersCounts </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name builtin">Array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollQuestion</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">length</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>fill</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choice </span><span class="token keyword" style=color:#00009f>of</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>values</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollAnswers</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    answersCounts</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">choice</span><span class="token punctuation" style=color:#393A34>]</span><span class="token operator" style=color:#393A34>++</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> answersList</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token maybe-class-name">BoxElement</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choicesOptions</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token maybe-class-name">OptionElement</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">index</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> choice</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>of</span><span class="token plain"> pollQuestion</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>entries</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> key </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> index</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>toString</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    answersList</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>push</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Box</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>key</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>key</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">          </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">choice</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain-text">: </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">answersCounts</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">index</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Box</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    choicesOptions</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>push</span><span class="token punctuation" style=color:#393A34>(</span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Option</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>key</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>key</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>choice</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>value</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>index</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>      </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>pollQuestion</span><span class="token tag script language-javascript punctuation" style=color:#393A34>.</span><span class="token tag script language-javascript property-access" style=color:#00009f>title</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>      </span><span class="token tag attr-name" style=color:#00a4db>input</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>OptionsInput</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>></span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>choicesOptions</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>OptionsInput</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token tag" style=color:#00009f>      </span><span class="token tag attr-name" style=color:#00a4db>actions</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Submit</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Stack</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">pollQuestion</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">title</span><span class="token punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Stack</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">answersList</span><span class="token punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Stack</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Stack</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain" style=display:inline-block></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token keyword" style=color:#00009f>export</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>default</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>handle</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token string-property property" style=color:#36acaa>'/'</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> createPollHandler</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain">  </span><span class="token string-property property" style=color:#36acaa>'/polls/:id'</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> displayPollHandler</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_nJzu" style=color:#393A34><span class=codeLineNumber__202></span><span class=codeLineContent_WQWn><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span></span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>The action handling logic (line 24) happens before the display logic so the submitted choice can be taken into account when couting the answers. Here we simply check if a value is provided and must be saved (line 27) or when no value is submitted but a previous choice was saved, we remove it (line 31).</p>
<p>By updating the <code>pollAnswers</code> object based on the submission before counting the choices (line 39), we can ensure the submission is taken into account.</p>
<h2 class="anchor anchorWithStickyNavbar_yaAl" id=wrapping-up>Wrapping up<a href=#wrapping-up class=hash-link aria-label="Direct link to Wrapping up" title="Direct link to Wrapping up">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_yaAl" id=running-the-server>Running the server<a href=#running-the-server class=hash-link aria-label="Direct link to Running the server" title="Direct link to Running the server">​</a></h3>
<p>Let's update our <code>package.json</code> to add a <code>start</code> script using the Tairu CLI:</p>
<div class="language-json codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_QsD_>package.json</div><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-json codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_juFO><span class=token-line style=color:#393A34><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"scripts"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>"start"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"tairu serve ./handler.tsx"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>We can then use the package manager to start the server:</p>
<div class="tabs-container tabList_Catn"><ul role=tablist aria-orientation=horizontal class=tabs><li role=tab tabindex=0 aria-selected=true class="tabs__item tabItem_mfQ4 tabs__item--active">npm<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_mfQ4">pnpm</ul><div class=margin-top--md><div role=tabpanel class=tabItem_TBo_><div class="language-sh codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-sh codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_juFO><span class=token-line style=color:#393A34><span class="token plain">npm start</span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div></div><div role=tabpanel class=tabItem_TBo_ hidden><div class="language-sh codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-sh codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_juFO><span class=token-line style=color:#393A34><span class="token plain">pnpm start</span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div></div></div></div>
<p>That's it! We can now open the poll creation Tile on <code>http://localhost:3210</code> to create polls, and interact with them at the dynamically generated poll URLs.</p>
<h3 class="anchor anchorWithStickyNavbar_yaAl" id=full-handler-code>Full handler code<a href=#full-handler-code class=hash-link aria-label="Direct link to Full handler code" title="Direct link to Full handler code">​</a></h3>
<p>Here is the full handler code from this guide, for reference:</p>
<div class="language-tsx codeBlockContainer_kYv4 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_QsD_>handler.tsx</div><div class=codeBlockContent_rjhk><pre tabindex=0 class="prism-code language-tsx codeBlock_qGvK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_juFO><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token maybe-class-name">Box</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">BoxElement</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">BoxProps</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token maybe-class-name">OpenAction</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token maybe-class-name">Option</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">OptionElement</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token maybe-class-name">OptionsInput</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token maybe-class-name">SubmitAction</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token maybe-class-name">Text</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token maybe-class-name">TextInput</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token maybe-class-name">Tile</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">TileHandler</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  handle</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'@tairu/handler'</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token maybe-class-name">BoxStyleV0</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'@tairu/protocol'</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> </span><span class="token imports punctuation" style=color:#393A34>{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Level</span><span class="token imports"> </span><span class="token imports punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'level'</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">PollQuestion</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  title</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  choices</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">PollAnswers</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token maybe-class-name">Record</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// DID to choice index</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> db </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Level</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'polls-db'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> questionsDB </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> db</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">sublevel</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token maybe-class-name">PollQuestion</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'questions'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> valueEncoding</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'json'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> answersDB </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> db</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">sublevel</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token maybe-class-name">PollAnswers</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'answers'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> valueEncoding</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'json'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">CreatePollState</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  question</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  choices</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">string</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  save</span><span class="token operator" style=color:#393A34>?</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>displayPollChoice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">state</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">CreatePollState</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choicesCount </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">length</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> saveAction </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>key</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>save</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Save poll</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>state</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript spread operator" style=color:#393A34>...</span><span class="token tag script language-javascript" style=color:#00009f>state</span><span class="token tag script language-javascript punctuation" style=color:#393A34>,</span><span class="token tag script language-javascript" style=color:#00009f> save</span><span class="token tag script language-javascript operator" style=color:#393A34>:</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript boolean" style=color:#36acaa>true</span><span class="token tag script language-javascript" style=color:#00009f> </span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> actions </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Max number of choices, only action is to save the poll</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    choicesCount </span><span class="token operator" style=color:#393A34>===</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>4</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>?</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      saveAction</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// At least 2 choices must be provided</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    choicesCount </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>?</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Next</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>state</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>state</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// 2 options: add another choice or save the poll</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>[</span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>key</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>next</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Add another choice</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>state</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>state</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> saveAction</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Create a new poll</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>input</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>TextInput</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Choice value</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>actions</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>actions</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">Add choice number </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">choicesCount </span><span class="token operator" style=color:#393A34>+</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain-text"> to the poll</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> createPollHandler</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token function-variable function" style=color:#d73a49>TileHandler</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f></span><br></span><span class=token-line style=color:#393A34><span class="token tag" style=color:#00009f>        </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Create a new poll</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f></span><br></span><span class=token-line style=color:#393A34><span class="token tag" style=color:#00009f>        </span><span class="token tag attr-name" style=color:#00a4db>input</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>TextInput</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Poll question</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f></span><br></span><span class=token-line style=color:#393A34><span class="token tag" style=color:#00009f>        </span><span class="token tag attr-name" style=color:#00a4db>actions</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Next</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">Create a new poll by first setting a question</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>!==</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'did/submit'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Poll error</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">Unsupported action</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// If there is no state in the action, it's setting the question</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>displayPollChoice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> question</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> choices</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> state </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token maybe-class-name">CreatePollState</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> newChoice </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choices </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> newChoice </span><span class="token operator" style=color:#393A34>===</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>''</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>?</span><span class="token plain"> state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token spread operator" style=color:#393A34>...</span><span class="token plain">state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> newChoice</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>!</span><span class="token plain">state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">save</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>||</span><span class="token plain"> choices</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Add another choice to the poll</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>displayPollChoice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token spread operator" style=color:#393A34>...</span><span class="token plain">state</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> choices </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Save the poll to the database</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> id </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> crypto</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>randomUUID</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> questionsDB</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>put</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">id</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> title</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> state</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">question</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> choices </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f></span><br></span><span class=token-line style=color:#393A34><span class="token tag" style=color:#00009f>      </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Poll created!</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f></span><br></span><span class=token-line style=color:#393A34><span class="token tag" style=color:#00009f>      </span><span class="token tag attr-name" style=color:#00a4db>actions</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>OpenAction</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Open poll</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>uri</span><span class="token tag script language-javascript tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag script language-javascript template-string template-punctuation string" style=color:#e3116c>`</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation" style=color:#00009f>request</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation punctuation" style=color:#393A34>.</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation" style=color:#00009f>urlPrefix</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript tag script language-javascript template-string string" style=color:#e3116c>/polls/</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation" style=color:#00009f>id</span><span class="token tag script language-javascript tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript tag script language-javascript template-string template-punctuation string" style=color:#e3116c>`</span><span class="token tag script language-javascript tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">The poll was successfully created!</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>Stack</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">props</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">BoxProps</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> style</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">BoxStyleV0</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token spread operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">props</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>??</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> flexDirection</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'column'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Box</span><span class="token tag" style=color:#00009f> </span><span class="token tag spread punctuation" style=color:#393A34>{</span><span class="token tag spread operator" style=color:#393A34>...</span><span class="token tag spread" style=color:#00009f>props</span><span class="token tag spread punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>style</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>style</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> displayPollHandler</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">TileHandler</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> id</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> pollID </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">pathParams</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">id</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> pollQuestion</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">PollQuestion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> pollAnswers</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token maybe-class-name">PollAnswers</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>try</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    pollQuestion </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> questionsDB</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>get</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollID</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>catch</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>Poll not found</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text">Poll not found</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>try</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    pollAnswers </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> answersDB</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>get</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollID</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>catch</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    pollAnswers </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token operator" style=color:#393A34>?.</span><span class="token plain">type </span><span class="token operator" style=color:#393A34>===</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'did/submit'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> did </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">did</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choice </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">action</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token builtin">number</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">choice </span><span class="token operator" style=color:#393A34>!=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// Save provided choice</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      pollAnswers</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">did</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> choice</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> answersDB</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>put</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollID</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> pollAnswers</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>else</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollAnswers</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">did</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>!=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// No choice provided, remove existing one</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token keyword" style=color:#00009f>delete</span><span class="token plain"> pollAnswers</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">did</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> answersDB</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>put</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollID</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> pollAnswers</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> answersCounts </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name builtin">Array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollQuestion</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">length</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>fill</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choice </span><span class="token keyword" style=color:#00009f>of</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>values</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pollAnswers</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    answersCounts</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">choice</span><span class="token punctuation" style=color:#393A34>]</span><span class="token operator" style=color:#393A34>++</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> answersList</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token maybe-class-name">BoxElement</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> choicesOptions</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token maybe-class-name">OptionElement</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">index</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> choice</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>of</span><span class="token plain"> pollQuestion</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">choices</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>entries</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> key </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> index</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>toString</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    answersList</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>push</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Box</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>key</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>key</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">          </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">choice</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain-text">: </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">answersCounts</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">index</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Box</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    choicesOptions</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>push</span><span class="token punctuation" style=color:#393A34>(</span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Option</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>key</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>key</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>choice</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>value</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>index</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag" style=color:#00009f></span><br></span><span class=token-line style=color:#393A34><span class="token tag" style=color:#00009f>      </span><span class="token tag attr-name" style=color:#00a4db>title</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>pollQuestion</span><span class="token tag script language-javascript punctuation" style=color:#393A34>.</span><span class="token tag script language-javascript property-access" style=color:#00009f>title</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f></span><br></span><span class=token-line style=color:#393A34><span class="token tag" style=color:#00009f>      </span><span class="token tag attr-name" style=color:#00a4db>input</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>OptionsInput</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>></span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript" style=color:#00009f>choicesOptions</span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>OptionsInput</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag" style=color:#00009f></span><br></span><span class=token-line style=color:#393A34><span class="token tag" style=color:#00009f>      </span><span class="token tag attr-name" style=color:#00a4db>actions</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#393A34>=</span><span class="token tag script language-javascript punctuation" style=color:#393A34>{</span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>&lt;</span><span class="token tag script language-javascript tag class-name" style=color:#00009f>SubmitAction</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag attr-name" style=color:#00a4db>label</span><span class="token tag script language-javascript tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag attr-value" style=color:#e3116c>Submit</span><span class="token tag script language-javascript tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag script language-javascript tag" style=color:#00009f> </span><span class="token tag script language-javascript tag punctuation" style=color:#393A34>/></span><span class="token tag script language-javascript punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Stack</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">pollQuestion</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">title</span><span class="token punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Text</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag class-name" style=color:#00009f>Stack</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">answersList</span><span class="token punctuation" style=color:#393A34>}</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Stack</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Stack</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#393A34><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag class-name" style=color:#00009f>Tile</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>export</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>default</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>handle</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token string-property property" style=color:#36acaa>'/'</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> createPollHandler</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token string-property property" style=color:#36acaa>'/polls/:id'</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> displayPollHandler</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup_x4oj><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_kyUL aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_t2M5><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_KTcX><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_yaAl" id=next-steps>Next steps<a href=#next-steps class=hash-link aria-label="Direct link to Next steps" title="Direct link to Next steps">​</a></h3>
<p>Congratulations for going through this guide! It hopefully gave you a good overview of how to start using Tairu to create Tile handlers.</p>
<p>To dig deeper, make sure to go over the <a href=/docs/concepts>core concepts</a> and the <a href=/docs/protocol>protocol</a> to get a better understanding of the possibilities.</div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/docs/quick-start><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Quick start</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/docs/agents><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Agent libraries</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_xAfr thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#project-overview class="table-of-contents__link toc-highlight">Project overview</a><ul><li><a href=#what-are-we-building class="table-of-contents__link toc-highlight">What are we building?</a><li><a href=#tairu-concepts-we-will-cover class="table-of-contents__link toc-highlight">Tairu concepts we will cover</a></ul><li><a href=#setting-up-the-project class="table-of-contents__link toc-highlight">Setting up the project</a><ul><li><a href=#project-creation class="table-of-contents__link toc-highlight">Project creation</a><li><a href=#adding-dependencies class="table-of-contents__link toc-highlight">Adding dependencies</a><li><a href=#database-setup class="table-of-contents__link toc-highlight">Database setup</a></ul><li><a href=#poll-creation class="table-of-contents__link toc-highlight">Poll creation</a><ul><li><a href=#setting-the-poll-question class="table-of-contents__link toc-highlight">Setting the poll question</a><li><a href=#adding-choices class="table-of-contents__link toc-highlight">Adding choices</a><li><a href=#saving-the-poll class="table-of-contents__link toc-highlight">Saving the poll</a><li><a href=#serving-the-tile-handler class="table-of-contents__link toc-highlight">Serving the Tile handler</a></ul><li><a href=#poll-display class="table-of-contents__link toc-highlight">Poll display</a><ul><li><a href=#loading-from-the-database class="table-of-contents__link toc-highlight">Loading from the database</a><li><a href=#displaying-the-poll class="table-of-contents__link toc-highlight">Displaying the poll</a><li><a href=#handling-submissions class="table-of-contents__link toc-highlight">Handling submissions</a></ul><li><a href=#wrapping-up class="table-of-contents__link toc-highlight">Wrapping up</a><ul><li><a href=#running-the-server class="table-of-contents__link toc-highlight">Running the server</a><li><a href=#full-handler-code class="table-of-contents__link toc-highlight">Full handler code</a><li><a href=#next-steps class="table-of-contents__link toc-highlight">Next steps</a></ul></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class=footer__title>Docs</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/docs/overview>Overview</a><li class=footer__item><a class=footer__link-item href=/docs/getting-started>Getting started</a></ul></div><div class="col footer__col"><div class=footer__title>Reference</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/docs/concepts>Concepts</a><li class=footer__item><a class=footer__link-item href=/docs/protocol>Protocol</a><li class=footer__item><a class=footer__link-item href=/docs/cli>CLI</a><li class=footer__item><a class=footer__link-item href=/docs/api>APIs</a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2024 Tairu Framework.</div></div></div></footer></div>